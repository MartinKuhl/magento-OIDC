    <!-- Test OAuth Flow Button -->
    <div class="debug-section">
        <h2 class="section-title">
            <span class="icon">ðŸ§ª</span>
            <?= __('Test OIDC Flow') ?>
        </h2>
        <div class="test-actions">
            <p><?= __('Trigger a complete OIDC authentication flow with Authelia:') ?></p>
            <div class="button-group">
                <a href="<?= $block->getUrl('', ['_direct' => 'mooauth/actions/sendauthorizationrequest']) ?>"     class="action-primary scalable" target="_blank">
                    <span><?= __('Start OAuth Flow') ?></span>
                </a>
                <a href="<?= $block->getUrl('adminhtml/auth/logout') ?>"
                   class="action-secondary scalable">
                    <span><?= __('Logout Current Session') ?></span>
                </a>
            </div>
        </div>
    </div>

    <!-- Troubleshooting Tips -->
    <div class="debug-section">
        <h2 class="section-title">
            <span class="icon">ðŸ’¡</span>
            <?= __('Troubleshooting Tips') ?>
        </h2>
        <div class="tips-container">
            <div class="tip-item">
                <strong><?= __('Connection Failed?') ?></strong>
                <ul>
                    <li><?= __('Check if Authelia is running and accessible') ?></li>
                    <li><?= __('Verify firewall rules allow HTTPS traffic') ?></li>
                    <li><?= __('Ensure SSL certificates are valid') ?></li>
                </ul>
            </div>
            <div class="tip-item">
                <strong><?= __('User Not Found?') ?></strong>
                <ul>
                    <li><?= __('Check if email attribute mapping is correct') ?></li>
                    <li><?= __('Verify admin user exists with matching email') ?></li>
                    <li><?= __('Review recent log entries for details') ?></li>
                </ul>
            </div>
            <div class="tip-item">
                <strong><?= __('Session Issues?') ?></strong>
                <ul>
                    <li><?= __('Clear browser cookies and try again') ?></li>
                    <li><?= __('Check SameSite cookie settings') ?></li>
                    <li><?= __('Verify session storage is writable') ?></li>
                </ul>
            </div>
        </div>
    </div>

</div>

<script>
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    const text = element.textContent;
    
    navigator.clipboard.writeText(text).then(function() {
        alert('<?= __('Copied to clipboard!') ?>');
    }, function(err) {
        console.error('Could not copy text: ', err);
        alert('<?= __('Failed to copy to clipboard') ?>');
    });
}

function filterLogs(type) {
    const logLines = document.querySelectorAll('.log-line');
    
    logLines.forEach(line => {
        if (type === 'all') {
            line.style.display = '';
        } else if (type === 'ERROR') {
            if (line.classList.contains('log-error')) {
                line.style.display = '';
            } else {
                line.style.display = 'none';
            }
        }
    });
}
</script>

<style>
.debug-container {
    background: #f5f5f5;
    padding: 20px;
}

.debug-header {
    background: white;
    padding: 30px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.debug-header h1 {
    margin: 0 0 10px 0;
    color: #333;
}

.debug-subtitle {
    color: #666;
    margin: 0 0 20px 0;
}

.debug-refresh-btn {
    margin-top: 10px;
}

.debug-section {
    background: white;
    padding: 25px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.section-title {
    margin: 0 0 20px 0;
    padding-bottom: 15px;
    border-bottom: 2px solid #eb5202;
    color: #333;
    font-size: 20px;
}

.section-title .icon {
    margin-right: 10px;
    font-size: 24px;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 15px;
}

.info-item {
    padding: 10px;
    background: #f9f9f9;
    border-radius: 4px;
}

.info-label {
    font-weight: bold;
    color: #666;
    margin-right: 10px;
}

.info-value {
    color: #333;
}

.config-table table {
    width: 100%;
    border-collapse: collapse;
}

.config-table th {
    background: #f0f0f0;
    padding: 12px;
    text-align: left;
    font-weight: bold;
    border-bottom: 2px solid #ddd;
}

.config-table td {
    padding: 12px;
    border-bottom: 1px solid #eee;
}

.config-key {
    font-weight: bold;
    color: #555;
    width: 30%;
}

.config-value code {
    background: #f5f5f5;
    padding: 4px 8px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    font-size: 13px;
}

.connection-tests {
    display: grid;
    gap: 15px;
}

.test-result {
    padding: 15px;
    border-radius: 6px;
    border-left: 4px solid;
}

.test-result.success {
    background: #e8f5e9;
    border-left-color: #4caf50;
}

.test-result.error {
    background: #ffebee;
    border-left-color: #f44336;
}

.test-header {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.test-icon {
    font-size: 24px;
    margin-right: 10px;
}

.test-details {
    display: flex;
    flex-direction: column;
    gap: 5px;
    font-size: 14px;
}

.test-details code {
    background: white;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 12px;
}

.response-container,
.log-container {
    position: relative;
}

.response-toolbar,
.log-toolbar {
    margin-bottom: 10px;
    display: flex;
    gap: 10px;
}

.json-output,
.log-output {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 20px;
    border-radius: 6px;
    overflow-x: auto;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    line-height: 1.6;
    max-height: 500px;
    overflow-y: auto;
}

.log-line {
    display: block;
}

.log-error {
    color: #f48771;
    font-weight: bold;
}

.log-warning {
    color: #dcdcaa;
}

.log-debug {
    color: #9cdcfe;
}

.no-data {
    text-align: center;
    padding: 40px;
    color: #666;
}

.no-data p {
    margin: 10px 0;
}

.test-actions {
    padding: 20px;
    background: #f9f9f9;
    border-radius: 6px;
}

.button-group {
    display: flex;
    gap: 15px;
    margin-top: 15px;
}

.tips-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.tip-item {
    padding: 15px;
    background: #f9f9f9;
    border-radius: 6px;
    border-left: 4px solid #eb5202;
}

.tip-item strong {
    display: block;
    margin-bottom: 10px;
    color: #333;
}

.tip-item ul {
    margin: 0;
    padding-left: 20px;
}

.tip-item li {
    margin: 8px 0;
    color: #666;
}
</style>
