<!-- 
        This template shows a SSO box on the admin backend pages
        Use this if you want to show a sso button on your backend pages
    -->
<div class="actions" style="text-align:center; width:100%;">
    <div style="display:flex; flex-direction:row; flex-wrap:nowrap; align-items:center; width:100%; gap:10px; margin:15px 0;">
        <span style="flex:1 1 0%; height:1px; background-color:#969393;"></span>
        <span style="flex:0 0 auto; white-space:nowrap; font-weight:bold; color:#444;">OR</span>
        <span style="flex:1 1 0%; height:1px; background-color:#969393;"></span>
    </div>
    <?php
    /** @var \MiniOrange\OAuth\Block\Adminhtml\AdminSSOButton $block */
    $oauthHelper = $block->getOauthHelper();
    $adminSPInitiatedUrl = $oauthHelper->getAdminSPInitiatedUrl();
    $appName = $oauthHelper->getAppName();
    $isOAuthConfigured = $oauthHelper->isOAuthConfigured();
    ?>
    <?php if ($isOAuthConfigured) : ?>
        <a href="<?= $block->escapeUrl($adminSPInitiatedUrl) ?>"
           style="display:block; width:100%; padding:12px 0; font-weight:bold; font-size:1.4rem;
                  text-align:center; background-color:#eb5202; color:#fff; border-radius:4px;
                  text-decoration:none; box-sizing:border-box; transition:background-color 0.3s ease-in-out;"
           onmouseover="this.style.backgroundColor='#c44400'"
           onmouseout="this.style.backgroundColor='#eb5202'">
            Login with <?= $block->escapeHtml($appName) ?>
        </a>
    <?php endif; ?>
</div>

<script>
    require(['jquery', 'domReady!'], function ($) {
        'use strict';

        // Move the SSO block after the standard Magento login button
        var ssoBlock = $('.form-actions .actions').last();
        var loginButton = $('.form-actions .actions').first();

        if (ssoBlock.length && loginButton.length && ssoBlock[0] !== loginButton[0]) {
            loginButton.after(ssoBlock);
        }

        // Hide standard Magento actions div and OR separator from OIDC div
        var actionsDivs = document.querySelectorAll('.form-actions .actions');
        actionsDivs.forEach(function (div) {
            var svgs = div.querySelectorAll('svg');
            if (svgs.length > 0) {
                div.style.display = 'none';
            }
        });
    });
</script>
